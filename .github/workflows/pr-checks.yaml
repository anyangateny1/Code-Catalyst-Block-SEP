name: PR Assignee/Reviewer Check

on:
  pull_request:
    types: [opened, edited, reopened, ready_for_review]

jobs:
  validate-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR assignment
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const assignees = pr.assignees || [];
            const reviewers = pr.requested_reviewers || [];

            // Rule 1: Exactly one assignee
            if (assignees.length !== 1) {
              core.setFailed(`PR must have exactly ONE assignee (found ${assignees.length}).`);
            }

            // Rule 2: Exactly one reviewer
            if (reviewers.length !== 1) {
              core.setFailed(`PR must have exactly ONE reviewer (found ${reviewers.length}).`);
            }

            // Rule 3: Assignee â‰  Reviewer
            if (assignees.length === 1 && reviewers.length === 1) {
              if (assignees[0].login === reviewers[0].login) {
                core.setFailed(`Assignee and reviewer cannot be the same person.`);
              }
            }

            console.log("Assignee and reviewer setup looks good!");
